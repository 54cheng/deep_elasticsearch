# 1、elasticsearch 重启第一次查询太慢

集群中有50亿数据，重启es集群，执行echo 3 > /proc/sys/vm/drop_cache之后单条件精确匹配时间有7s多，

io跑满从磁盘读大量数据，第二次执行则几百毫秒，如何提升第一次查询的速度呢?

https://elasticsearch.cn/question/9511

【回复】

warm_up_the_filesystem_cache

https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-search-speed.html#_warm_up_the_filesystem_cache

# 2、logstash应该如何同步到List形式的ES对象字段呢

请教各位老哥，小弟用logstash从PG数据库中同步数据到ES（logstash和ES版本都是6.5.2），需要同步的数据如图

https://elasticsearch.cn/question/9752

【medcl 回复】

这里主要是看如何合并多条记录到一个文档里面，首先要看这些记录是不是都是静态的，如果有更新则还要考虑更新的问题。有多种实现方式：
 
一种是在 Logstash 里面按主 key 排序，根据主 key 在内存里面合并成一个完整的对象，判断出现新的 key 的时候，发送到 Output 里面。

具体可以参照 Aggregate Filter的用法：https://www.elastic.co/guide/en/logstash/current/plugins-filters-aggregate.html
 
另外一种则是用 es 端来做 upsert 聚合，具体参照我的这篇文章：https://mp.weixin.qq.com/s/H1I3EeXEaOWpEBSR_SRBow

注意这种方式会对 Elasticsearch 造成额外的更新压力，适合数据量不大的场景。
 
如果数据量很大，还是建议自己写程序来合并封装，要更加灵活和可控，性能也会好一点。

# 3、es在搜索无输入关键词下使用boost权重

现有一个索引，a。字段有content-句子，times-句子使用频次，想通过用户关键词匹配匹配到content句子同时使用频次作为权重优化输出句子，

但是频次无法使用具体值，只能作为一个权重，所以想通过直接为频次设置boost权重来搜索句子，es并不支持在无键入情况下使用boost，这种问题该如何解决呢？
es使用版本 2.x

【回复】
参考：

```
GET /_search
{
    "query": {
        "function_score": {
            "field_value_factor": {
                "field": "likes",
                "factor": 1.2,
                "modifier": "sqrt",
                "missing": 1
            }
        }
    }
}
```
